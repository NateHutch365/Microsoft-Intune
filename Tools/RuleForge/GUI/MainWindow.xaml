<Window x:Class="RuleForgeGUI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="ðŸ”¥ RuleForge v2.0 - Blacksmithing Firewall Rules" 
        Height="750" Width="900"
        MinHeight="650" MinWidth="800"
        Background="{StaticResource ForgeDarkBrush}"
        WindowStartupLocation="CenterScreen">
    
    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="150"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,15">
            <TextBlock Text="ðŸ”¥ RuleForge" FontSize="28" FontWeight="Bold" 
                       Foreground="{StaticResource ForgeYellowBrush}" 
                       HorizontalAlignment="Center"/>
            <TextBlock Text="Blacksmithing Windows Defender Firewall Rules for Intune" 
                       FontSize="14" Foreground="{StaticResource ForgeTextBrush}" 
                       HorizontalAlignment="Center" Margin="0,5,0,0"/>
        </StackPanel>

        <!-- Main Tab Control -->
        <TabControl Grid.Row="1" Background="{StaticResource ForgeGrayBrush}" 
                    BorderBrush="{StaticResource ForgeOrangeBrush}" BorderThickness="1">
            
            <!-- Capture Tab -->
            <TabItem Header="ðŸ“¸ Capture Rules" Background="{StaticResource ForgeGrayBrush}" 
                     Foreground="{StaticResource ForgeTextBrush}">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Margin="10">
                    <StackPanel>
                        <!-- Capture Type Selection -->
                        <GroupBox Header="Capture Type" Style="{StaticResource ForgeGroupBox}">
                            <StackPanel>
                                <RadioButton x:Name="rbBaseline" Content="Baseline Capture" 
                                             IsChecked="True" Margin="5" FontSize="13"
                                             Foreground="{StaticResource ForgeTextBrush}"/>
                                <TextBlock Text="Capture rules from a clean/reference system before installing applications." 
                                           Foreground="Gray" FontSize="11" Margin="25,0,0,10" TextWrapping="Wrap"/>
                                
                                <RadioButton x:Name="rbPostInstall" Content="Post-Install Capture" 
                                             Margin="5" FontSize="13"
                                             Foreground="{StaticResource ForgeTextBrush}"/>
                                <TextBlock Text="Capture rules after installing applications to identify new rules." 
                                           Foreground="Gray" FontSize="11" Margin="25,0,0,5" TextWrapping="Wrap"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- Output Settings -->
                        <GroupBox Header="Output Settings" Style="{StaticResource ForgeGroupBox}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <Label Content="Output File:" Style="{StaticResource ForgeLabel}" 
                                       Grid.Row="0" Grid.Column="0" VerticalAlignment="Center"/>
                                <TextBox x:Name="txtCaptureOutput" Text="baseline.json" 
                                         Style="{StaticResource ForgeTextBox}"
                                         Grid.Row="0" Grid.Column="1" Margin="5"/>
                                <Button Content="Browse..." Click="BrowseCaptureOutput_Click" 
                                        Style="{StaticResource ForgeButton}"
                                        Grid.Row="0" Grid.Column="2" Margin="5" Padding="10,5"/>

                                <Label Content="Output Format:" Style="{StaticResource ForgeLabel}" 
                                       Grid.Row="1" Grid.Column="0" VerticalAlignment="Center"/>
                                <ComboBox x:Name="cmbCaptureFormat" SelectedIndex="0" 
                                          Style="{StaticResource ForgeComboBox}"
                                          Grid.Row="1" Grid.Column="1" Margin="5">
                                    <ComboBoxItem Content="JSON"/>
                                    <ComboBoxItem Content="CSV"/>
                                </ComboBox>
                            </Grid>
                        </GroupBox>

                        <!-- Filter Options -->
                        <GroupBox Header="Filter Options" Style="{StaticResource ForgeGroupBox}">
                            <StackPanel>
                                <CheckBox x:Name="chkSkipDisabled" Content="Skip Disabled Rules" 
                                          Style="{StaticResource ForgeCheckBox}"/>
                                <TextBlock Text="Exclude rules that are currently disabled." 
                                           Foreground="Gray" FontSize="11" Margin="25,0,0,10" TextWrapping="Wrap"/>
                                
                                <CheckBox x:Name="chkSkipDefault" Content="Skip Default Windows Rules" 
                                          Style="{StaticResource ForgeCheckBox}"/>
                                <TextBlock Text="Exclude default Windows rules using DefaultRules.json file." 
                                           Foreground="Gray" FontSize="11" Margin="25,0,0,10" TextWrapping="Wrap"/>
                                
                                <Grid Margin="0,10,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Label Content="Profile Type:" Style="{StaticResource ForgeLabel}" 
                                           VerticalAlignment="Center"/>
                                    <ComboBox x:Name="cmbProfileType" SelectedIndex="0" 
                                              Style="{StaticResource ForgeComboBox}" Grid.Column="1" Margin="5,0">
                                        <ComboBoxItem Content="All"/>
                                        <ComboBoxItem Content="Private"/>
                                        <ComboBoxItem Content="Public"/>
                                        <ComboBoxItem Content="Domain"/>
                                        <ComboBoxItem Content="Private,Public"/>
                                        <ComboBoxItem Content="Private,Domain"/>
                                        <ComboBoxItem Content="Public,Domain"/>
                                    </ComboBox>
                                </Grid>
                            </StackPanel>
                        </GroupBox>

                        <!-- Capture Button -->
                        <Button x:Name="btnCapture" Content="ðŸ”¨ Start Capture" 
                                Style="{StaticResource ForgeButton}" 
                                Click="StartCapture_Click" 
                                Margin="0,15" Height="45" FontSize="16"/>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Compare Tab -->
            <TabItem Header="âš”ï¸ Compare Rules" Background="{StaticResource ForgeGrayBrush}" 
                     Foreground="{StaticResource ForgeTextBrush}">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Margin="10">
                    <StackPanel>
                        <!-- Input Files -->
                        <GroupBox Header="Input Files" Style="{StaticResource ForgeGroupBox}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <Label Content="Baseline File:" Style="{StaticResource ForgeLabel}" 
                                       Grid.Row="0" Grid.Column="0" VerticalAlignment="Center"/>
                                <TextBox x:Name="txtBaselineFile" Text="baseline.json" 
                                         Style="{StaticResource ForgeTextBox}"
                                         Grid.Row="0" Grid.Column="1" Margin="5"/>
                                <Button Content="Browse..." Click="BrowseBaseline_Click" 
                                        Style="{StaticResource ForgeButton}"
                                        Grid.Row="0" Grid.Column="2" Margin="5" Padding="10,5"/>

                                <Label Content="Post-Install File:" Style="{StaticResource ForgeLabel}" 
                                       Grid.Row="1" Grid.Column="0" VerticalAlignment="Center"/>
                                <TextBox x:Name="txtPostInstallFile" Text="postinstall.json" 
                                         Style="{StaticResource ForgeTextBox}"
                                         Grid.Row="1" Grid.Column="1" Margin="5"/>
                                <Button Content="Browse..." Click="BrowsePostInstall_Click" 
                                        Style="{StaticResource ForgeButton}"
                                        Grid.Row="1" Grid.Column="2" Margin="5" Padding="10,5"/>
                            </Grid>
                        </GroupBox>

                        <!-- Compare Output Settings -->
                        <GroupBox Header="Output Settings" Style="{StaticResource ForgeGroupBox}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <Label Content="Output File:" Style="{StaticResource ForgeLabel}" 
                                       Grid.Row="0" Grid.Column="0" VerticalAlignment="Center"/>
                                <TextBox x:Name="txtCompareOutput" Text="newrules" 
                                         Style="{StaticResource ForgeTextBox}"
                                         Grid.Row="0" Grid.Column="1" Margin="5"/>
                                <Button Content="Browse..." Click="BrowseCompareOutput_Click" 
                                        Style="{StaticResource ForgeButton}"
                                        Grid.Row="0" Grid.Column="2" Margin="5" Padding="10,5"/>

                                <Label Content="Output Format:" Style="{StaticResource ForgeLabel}" 
                                       Grid.Row="1" Grid.Column="0" VerticalAlignment="Center"/>
                                <ComboBox x:Name="cmbCompareFormat" SelectedIndex="0" 
                                          Style="{StaticResource ForgeComboBox}"
                                          Grid.Row="1" Grid.Column="1" Margin="5">
                                    <ComboBoxItem Content="JSON"/>
                                    <ComboBoxItem Content="CSV"/>
                                    <ComboBoxItem Content="Both (JSON + CSV)"/>
                                </ComboBox>

                                <CheckBox x:Name="chkDualOutput" Content="Export as both JSON and CSV" 
                                          Style="{StaticResource ForgeCheckBox}" IsChecked="True"
                                          Grid.Row="2" Grid.Column="1" Margin="5,10,0,0"/>
                            </Grid>
                        </GroupBox>

                        <!-- Compare Button -->
                        <Button x:Name="btnCompare" Content="âš”ï¸ Compare Rules" 
                                Style="{StaticResource ForgeButton}" 
                                Click="StartCompare_Click" 
                                Margin="0,15" Height="45" FontSize="16"/>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Settings Tab -->
            <TabItem Header="âš™ï¸ Settings" Background="{StaticResource ForgeGrayBrush}" 
                     Foreground="{StaticResource ForgeTextBrush}">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Margin="10">
                    <StackPanel>
                        <!-- Default Rules Management -->
                        <GroupBox Header="Default Rules Management" Style="{StaticResource ForgeGroupBox}">
                            <StackPanel>
                                <TextBlock Text="DefaultRules.json is used to filter out default Windows rules during capture. Generate this file on a clean/OOBE system." 
                                           Foreground="{StaticResource ForgeTextBrush}" FontSize="12" 
                                           TextWrapping="Wrap" Margin="0,0,0,15"/>
                                
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <Label Content="Default Rules:" Style="{StaticResource ForgeLabel}" 
                                           VerticalAlignment="Center"/>
                                    <TextBox x:Name="txtDefaultRulesPath" Text="DefaultRules.json" 
                                             Style="{StaticResource ForgeTextBox}" Grid.Column="1" Margin="5"/>
                                    <Button Content="Browse..." Click="BrowseDefaultRules_Click" 
                                            Style="{StaticResource ForgeButton}"
                                            Grid.Column="2" Margin="5" Padding="10,5"/>
                                </Grid>
                                
                                <StackPanel Orientation="Horizontal" Margin="0,15,0,0">
                                    <Button x:Name="btnGenerateDefault" Content="ðŸ”§ Generate DefaultRules.json" 
                                            Style="{StaticResource ForgeButton}" 
                                            Click="GenerateDefaultRules_Click" Margin="0,0,10,0"/>
                                    <TextBlock x:Name="txtDefaultRulesStatus" 
                                               Foreground="{StaticResource ForgeTextBrush}" 
                                               VerticalAlignment="Center" FontSize="12"/>
                                </StackPanel>
                            </StackPanel>
                        </GroupBox>

                        <!-- Debug Settings -->
                        <GroupBox Header="Debug Settings" Style="{StaticResource ForgeGroupBox}">
                            <StackPanel>
                                <CheckBox x:Name="chkDebugOutput" Content="Enable Debug Output" 
                                          Style="{StaticResource ForgeCheckBox}"/>
                                <TextBlock Text="Shows detailed JSON processing information in the log." 
                                           Foreground="Gray" FontSize="11" Margin="25,0,0,10" TextWrapping="Wrap"/>
                                
                                <CheckBox x:Name="chkSaveDebugLog" Content="Save Debug Log to File" 
                                          Style="{StaticResource ForgeCheckBox}" IsChecked="True"/>
                                <TextBlock Text="Automatically saves all log output to RuleForge_debug.log in the output directory." 
                                           Foreground="Gray" FontSize="11" Margin="25,0,0,10" TextWrapping="Wrap"/>
                                
                                <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                    <Button Content="ðŸ“‚ Open Log Folder" 
                                            Style="{StaticResource ForgeButton}" 
                                            Click="OpenLogFolder_Click" Margin="0,0,10,0"/>
                                    <Button Content="ðŸ—‘ï¸ Clear Logs" 
                                            Style="{StaticResource ForgeButton}" 
                                            Click="ClearLogs_Click"/>
                                </StackPanel>
                            </StackPanel>
                        </GroupBox>

                        <!-- About -->
                        <GroupBox Header="About RuleForge" Style="{StaticResource ForgeGroupBox}">
                            <StackPanel>
                                <TextBlock Foreground="{StaticResource ForgeTextBrush}" FontSize="12" TextWrapping="Wrap">
                                    <Run FontWeight="Bold">RuleForge v2.0 GUI</Run><LineBreak/>
                                    <Run>A WPF-based GUI application for managing Windows Defender firewall rules for Microsoft Intune integration.</Run><LineBreak/><LineBreak/>
                                    <Run FontWeight="Bold">Author:</Run><Run> Nathan Hutchinson</Run><LineBreak/>
                                    <Run FontWeight="Bold">Website:</Run><Run> https://natehutchinson.co.uk</Run><LineBreak/>
                                    <Run FontWeight="Bold">GitHub:</Run><Run> https://github.com/NateHutch365</Run><LineBreak/><LineBreak/>
                                    <Run FontStyle="Italic" Foreground="Gray">The original CLI version (RuleForge.ps1) remains available for administrators who prefer command-line usage.</Run>
                                </TextBlock>
                            </StackPanel>
                        </GroupBox>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
        </TabControl>

        <!-- Progress Section -->
        <GroupBox Grid.Row="2" Header="Progress" Style="{StaticResource ForgeGroupBox}" Margin="0,10,0,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <TextBlock x:Name="txtStatus" Text="Ready to forge firewall rules..." 
                           Foreground="{StaticResource ForgeTextBrush}" FontSize="13" Margin="0,0,0,8"/>
                
                <Grid Grid.Row="1">
                    <ProgressBar x:Name="progressBar" Height="25" Minimum="0" Maximum="100" Value="0"
                                 Background="{StaticResource ForgeGrayBrush}" 
                                 Foreground="{StaticResource ForgeOrangeBrush}"/>
                    <TextBlock x:Name="txtProgressPercent" Text="0%" HorizontalAlignment="Center" 
                               VerticalAlignment="Center" Foreground="White" FontWeight="Bold"/>
                </Grid>
            </Grid>
        </GroupBox>

        <!-- Log Output -->
        <GroupBox Grid.Row="3" Header="ðŸ“œ Debug Log" Style="{StaticResource ForgeGroupBox}" Margin="0,10,0,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <TextBox x:Name="txtLog" IsReadOnly="True" TextWrapping="Wrap" 
                         VerticalScrollBarVisibility="Auto" 
                         Background="{StaticResource ForgeDarkBrush}"
                         Foreground="{StaticResource ForgeTextBrush}"
                         BorderThickness="0" FontFamily="Consolas" FontSize="11"/>
                
                <StackPanel Grid.Column="1" VerticalAlignment="Top" Margin="10,0,0,0">
                    <Button Content="ðŸ“‹" ToolTip="Copy Log" Click="CopyLog_Click" 
                            Style="{StaticResource ForgeButton}" Padding="8,5" Margin="0,0,0,5"/>
                    <Button Content="ðŸ—‘ï¸" ToolTip="Clear Log" Click="ClearLogDisplay_Click" 
                            Style="{StaticResource ForgeButton}" Padding="8,5"/>
                </StackPanel>
            </Grid>
        </GroupBox>
    </Grid>
</Window>
